(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();class w{constructor(t){this.url="wss://courselab.lnu.se/message-app/socket",this.socket=null,this.chat=t}connect(){this.socket=new WebSocket(this.url),this.socket.onopen=()=>{console.log("WebSocket connection successfully established")},this.socket.onmessage=t=>{try{const e=JSON.parse(t.data);e.type==="message"?(console.log('Message from user "'+e.username+'": '+e.data),this.chat.updateMessages(e)):e.type==="heartbeat"?console.log("Heartbeat"):console.log("Message from server:",e.data)}catch(e){console.log("Something went wrong with parsing message",e)}},this.socket.onerror=t=>{console.error("WebSocket error:",t)},this.socket.onclose=()=>{console.log("WebSocket connection closed.")}}sendMessage(t,e){if(this.socket&&this.socket.readyState===WebSocket.OPEN){const n={type:"message",data:t,username:e,channel:"my, not so secret, channel",key:"eDBE76deU7L0H9mEBgxUKVR0VCnq0XBd"};console.log("Sending message:",t),this.socket.send(JSON.stringify(n))}else console.error("WebSocket is not connected.")}disconnect(){this.socket&&this.socket.close()}}class h{static chatInstances=[];constructor(t){this.newItem=document.createElement("div"),this.newItem.classList.add("chat"),this.newItem.setAttribute("draggable","true");const e=document.createElement("h2");e.textContent="Chat",this.newItem.appendChild(e);const n=JSON.parse(window.localStorage.getItem("username")),s=document.createElement("h4");s.id="userNameDisplay",this.newItem.appendChild(s),n!=null&&(s.textContent="User: "+n);const i=document.createElement("button");i.id="closeButton",i.textContent="X",this.newItem.appendChild(i);const o=document.createElement("button");o.id="editButton",this.newItem.appendChild(o),this.editToggle=!1;const r=document.createElement("message");r.id="message",r.textContent="",this.newItem.appendChild(r),this.newItem.style.position="absolute",this.newItem.style.top=50+t*20+"px",this.newItem.style.left=450+t*20+"px",i.addEventListener("click",()=>{this.newItem.remove(),this.chatWebSocket.disconnect()}),o.addEventListener("click",()=>{this.editToggle?JSON.parse(window.localStorage.getItem("username"))!=null&&(this.profile.style.display="none",this.editToggle=!1,this.chatSectionDiv.style.display=""):(this.chatSectionDiv.style.display="none",this.createProfile())}),this.newItem.addEventListener("click",()=>{this.putOnTop()}),this.newItem.addEventListener("drag",()=>{this.putOnTop()}),document.querySelector("main").appendChild(this.newItem),this.putOnTop(),this.chatWebSocket=new w(this),this.chatWebSocket.connect(),n===null?this.createProfile():this.chatSection(),h.chatInstances.push(this)}chatSection(){this.chatSectionDiv=document.createElement("div"),this.chatSectionDiv.classList.add("chatSection"),this.newItem.appendChild(this.chatSectionDiv);const t=document.createElement("div");t.classList.add("chatMessages"),this.chatSectionDiv.appendChild(t);const e=document.createElement("textarea");e.classList.add("messageInput"),e.style.resize="none",this.chatSectionDiv.appendChild(e);const n=document.createElement("button");n.classList.add("sendButton"),this.chatSectionDiv.appendChild(n);const s=document.createElement("button");s.id="clearButton",this.newItem.appendChild(s),n.addEventListener("click",()=>{const i=e.value;i&&(e.value="",this.chatWebSocket.sendMessage(i,JSON.parse(window.localStorage.getItem("username"))))}),e.addEventListener("keydown",function(i){i.key==="Enter"&&(i.preventDefault(),n.click())}),s.addEventListener("click",()=>{for(;t.firstChild;)t.removeChild(t.firstChild)})}updateMessages(t){const e=document.createElement("div");e.classList.add("messageContainer");const n=document.createElement("div");n.textContent=t.username,n.style.fontWeight="bold",e.appendChild(n);const s=new Date,i=s.getHours().toString().padStart(2,"0")+":"+s.getMinutes().toString().padStart(2,"0")+":"+s.getSeconds().toString().padStart(2,"0"),o=document.createElement("div"),r=document.createElement("span");r.textContent=i,r.classList.add("messageTime"),o.appendChild(r),o.append(t.data),e.appendChild(o),e.classList.add("userMessage"),this.chatSectionDiv.getElementsByClassName("chatMessages")[0].appendChild(e);const l=this.chatSectionDiv.getElementsByClassName("chatMessages")[0];l.scrollTop=l.scrollHeight}putOnTop(){document.querySelectorAll(".chat, .memory, .paint").forEach(e=>{e.style.zIndex="1",e.classList.remove("focused")}),this.newItem.style.zIndex="2",this.newItem.classList.add("focused")}createProfile(){this.editToggle=!0,this.profile&&this.profile.remove(),this.profile=document.createElement("div"),this.profile.classList.add("profile-container"),this.newItem.appendChild(this.profile);const t=document.createElement("h3");t.textContent="Please enter your username",this.profile.appendChild(t);const e=document.createElement("input");e.className="usernameInput",this.profile.appendChild(e),e.addEventListener("keydown",function(i){i.key==="Enter"&&(i.preventDefault(),n.click())});const n=document.createElement("button");n.textContent="Submit",n.id="profileSubmitButton",this.profile.appendChild(n);const s=this.profile;n.addEventListener("click",()=>{const i=e.value;i.length>1&&i.length<15?(window.localStorage.setItem("username",JSON.stringify(i)),h.updateAllUsernames(i),this.editToggle=!1,s.style.display="none",this.newItem.querySelector("#message").textContent="",this.chatSection()):this.newItem.querySelector("#message").textContent="Username must be between 2-14 characters"})}static updateAllUsernames(t){h.chatInstances.forEach(e=>{const n=e.newItem.querySelector("#userNameDisplay");n&&(n.textContent="User: "+t)})}}class C{move(){const t=document.querySelectorAll(".item"),e=document.querySelector("main");t.forEach(n=>{n.addEventListener("dragstart",s=>{const i=window.getComputedStyle(s.target,null),o=parseInt(i.getPropertyValue("left"),10)-s.clientX,r=parseInt(i.getPropertyValue("top"),10)-s.clientY;s.dataTransfer.setData("text/plain",""),s.target.classList.add("dragging"),s.dataTransfer.setData("application/json",JSON.stringify({offsetX:o,offsetY:r}))})}),e.addEventListener("dragover",n=>{n.preventDefault()}),e.addEventListener("dragenter",n=>{n.preventDefault()}),e.addEventListener("drop",n=>{n.preventDefault();const s=document.querySelector(".dragging");if(s){const i=JSON.parse(n.dataTransfer.getData("application/json")),o=n.clientX-e.getBoundingClientRect().left-i.offsetX,r=n.clientY-e.getBoundingClientRect().top-i.offsetY;s.style.left=o+2*i.offsetX+"px",s.style.top=r+2*i.offsetY+"px",s.classList.remove("dragging")}})}addDraggableElement(t){t.addEventListener("dragstart",e=>{const n=window.getComputedStyle(e.target,null),s=parseInt(n.getPropertyValue("left"),10)-e.clientX,i=parseInt(n.getPropertyValue("top"),10)-e.clientY;e.dataTransfer.setData("text/plain",""),e.target.classList.add("dragging"),e.dataTransfer.setData("application/json",JSON.stringify({offsetX:s,offsetY:i}))})}}class S{constructor(){this.time=0,this.timer=null}start(){this.timer=setInterval(()=>{this.time++},1e3)}stop(){clearInterval(this.timer)}}const p="/assets/question-SizXsuiA.jpg",E="/assets/red-dwhur3bA.jpg",I="/assets/1-k8SZ9Vtx.jpg",v="/assets/2-mI34Rf0T.jpg",b="/assets/3-Vbxc03_Y.jpg",B="/assets/4-UClGLaOq.jpg",k="/assets/5-Q8KTN0Zx.jpg",x="/assets/6-UNlMmRkt.jpg",L="/assets/7-7gZpxne1.jpg",D="/assets/8-Bj8Rd60I.jpg",T="/assets/9-lQ-IPnf6.jpg",O="/assets/10-R_-HsgvX.jpg",z="/assets/11-OIHMI-8u.jpg",M="/assets/12-SneeGD5t.jpg",N="/assets/13-Je_57iMN.jpg",P="/assets/14-XXOnWVvo.jpg",A="/assets/15-t1SbeXRx.jpg",W="/assets/16-89By9g7B.jpg",j="/assets/17-Ejle5PSV.jpg";class q{constructor(t,e,n){this.newItem=document.createElement("div"),this.newItem.classList.add("memory"),this.newItem.setAttribute("draggable","true");const s=document.createElement("h2");s.textContent="Memory game",this.newItem.appendChild(s),this.pics=[],this.gameWon=!1,this.marked="none",this.activeButtons=!0,this.attempts=0,this.x=e,this.y=n,this.images={1:I,2:v,3:b,4:B,5:k,6:x,7:L,8:D,9:T,10:O,11:z,12:M,13:N,14:P,15:A,16:W,17:j};const i=document.createElement("button");i.id="closeButton",i.textContent="X",this.newItem.style.position="absolute",this.newItem.style.top=50+t*20+"px",this.newItem.style.left=50+t*20+"px",i.addEventListener("click",()=>{this.newItem.remove()}),this.newItem.appendChild(i),this.newItem.addEventListener("click",()=>{this.putOnTop()}),this.newItem.addEventListener("drag",()=>{this.putOnTop()}),document.querySelector("main").appendChild(this.newItem),this.putOnTop(),this.runGame(),this.randomNumbers=this.randomizePictures(),this.displayed=0,this.guesses=[],this.completed=[],this.correct=0,this.timer=new S,this.timerElement=document.createElement("div"),this.timerElement.classList.add("timer"),this.newItem.appendChild(this.timerElement),this.timer.start(),setInterval(()=>{const o=this.timer.time;this.gameWon||(this.timerElement.textContent=`Time: ${o} seconds. Attempts: ${this.attempts}`)},0),document.addEventListener("keydown",o=>{this.movemarker(o)})}movemarker(t){if(!this.gameWon&&this.newItem.classList.contains("focused")&&this.activeButtons){const e=t.code,n=this.newItem.querySelectorAll(".grid-item");switch(this.marked==="none"&&(this.marked=0),e){case"ArrowUp":this.marked<this.x?this.marked+=(this.y-1)*this.x:this.marked-=this.x;break;case"ArrowDown":this.marked>=this.x*this.y-this.x?this.marked-=(this.y-1)*this.x:this.marked+=this.x;break;case"ArrowLeft":this.marked%this.x===0?this.marked+=this.x-1:this.marked-=1;break;case"ArrowRight":(this.marked+1)%this.x===0&&this.marked!==0?this.marked-=this.x-1:this.marked+=1;break;case"Enter":t.preventDefault(),this.guess(this.marked,t,!1);break}n.forEach((s,i)=>{i===this.marked?s.style.borderColor="black":this.completed.includes(i)?s.style.borderColor="transparent":s.style.borderColor="#ccc"})}}putOnTop(){document.querySelectorAll(".chat, .memory, .paint").forEach(e=>{e.style.zIndex="1",e.classList.remove("focused")}),this.newItem.style.zIndex="2",this.newItem.classList.add("focused")}guess(t,e,n){if(this.completed.includes(t))return;this.guesses[this.displayed]=t,this.displayed+=1;let s;if(n?s=e.target.closest(".grid-item").querySelector("img"):s=this.newItem.querySelectorAll(".grid-item img")[t],s.src=this.images[this.randomNumbers[t]],console.log(s),this.displayed===1)this.pics[0]=s;else{if(this.pics[1]=s,this.guesses[0]===this.guesses[1]){this.displayed=1,this.guesses[1]=void 0;return}this.checkIfCorrect(),this.guesses=[],this.pics=[],this.displayed=0}}checkIfCorrect(){this.attempts+=1;const t=this.pics[0],e=this.pics[1],n=document.querySelectorAll(".grid-item");n.forEach(s=>{s.style.pointerEvents="none",this.activeButtons=!1}),this.randomNumbers[this.guesses[0]]!==this.randomNumbers[this.guesses[1]]?(setTimeout(()=>{t.src=E,e.src=E,n.forEach(s=>{s.style.pointerEvents="auto",this.activeButtons=!0})},1e3),setTimeout(()=>{t.src=p,e.src=p,n.forEach(s=>{s.style.pointerEvents="auto"})},1200)):(this.completed[this.correct*2]=this.guesses[0],this.completed[this.correct*2+1]=this.guesses[1],this.correct+=1,setTimeout(()=>{t.style.display="none",e.style.display="none",t.closest(".grid-item").style.borderColor="transparent",e.closest(".grid-item").style.borderColor="transparent",this.activeButtons=!0,n.forEach(s=>{s.style.pointerEvents="auto"})},800),this.correct===this.x*this.y/2&&(this.gameWon=!0,this.timer.stop(),this.timerElement.textContent=`You did it! It took: ${this.timer.time} seconds and ${this.attempts} attempts`))}runGame(){const t=document.createElement("div");t.classList.add("grid-container"),t.style.gridTemplateColumns=`repeat(${this.x}, 1fr)`,t.style.gridTemplateRows=`repeat(${this.y}, 1fr)`;for(let e=0;e<this.x*this.y;e++){const n=document.createElement("div");n.classList.add("grid-item");const s=document.createElement("img");s.src=p,n.appendChild(s),t.appendChild(n);const i=o=>r=>{this.guess(o,r,!0)};n.addEventListener("click",i(e))}this.newItem.appendChild(t)}randomizePictures(){const t=[];for(let e=0;e<this.x*this.y/2;e++){let n=Math.floor(Math.random()*(this.x*this.y+1))+1;for(;t.includes(n);)n=Math.floor(Math.random()*(this.x*this.y+1))+1;for(let s=0;s<2;s++){let i=Math.floor(Math.random()*(this.x*this.y));for(;t[i]!==void 0;)i=Math.floor(Math.random()*(this.x*this.y));t[i]=n}}return t}}class f{static paintInstances=[];constructor(t){this.newItem=document.createElement("div"),this.newItem.classList.add("paint"),this.newItem.setAttribute("draggable","true");const e=document.createElement("h2");e.textContent="Paint",this.newItem.appendChild(e);const n=document.createElement("button");n.id="closeButton",n.textContent="X",this.newItem.appendChild(n);const s=document.createElement("button");s.id="brushSizeButton",this.newItem.appendChild(s);const i=document.createElement("button");i.id="brushColorButton",this.newItem.appendChild(i);const o=document.createElement("button");o.id="erasorButton",this.newItem.appendChild(o);const r=document.createElement("button");r.id="clearPaintButton",this.newItem.appendChild(r),this.canvas=null,this.context=null,this.isPainting=!1,this.paintWidth=2,this.paintColor="black",this.paintSizeButtons=[],this.paintColorButtons=[],this.erasorButtons=[],this.newItem.style.position="absolute",this.newItem.style.top=50+t*20+"px",this.newItem.style.left=850+t*20+"px",n.addEventListener("click",()=>{this.newItem.remove()}),s.addEventListener("click",()=>{if(this.hideColorButtons(),this.hideErasorButtons(),this.paintSizeButtons.length===0){const l=document.createElement("div");[2,4,6,8,10,12,16,20].forEach(d=>{const a=document.createElement("button");a.textContent=`${d}`,a.classList.add("singleBrushSizeConfigButton"),a.addEventListener("click",()=>{this.paintWidth=d,this.hideSizeButtons()}),this.paintSizeButtons.push(a),s.parentElement.insertBefore(a,s.nextSibling),l.appendChild(a)}),this.paintSectionDiv.appendChild(l)}else this.hideSizeButtons()}),i.addEventListener("click",()=>{if(this.hideSizeButtons(),this.hideErasorButtons(),this.paintColorButtons.length===0){const l=document.createElement("div");["red","cyan","black","blue","green","yellow","purple","pink","lightgreen","orange"].forEach(d=>{const a=document.createElement("button");a.style.backgroundColor=`${d}`,a.classList.add("singleBrushColorConfigButton"),a.addEventListener("click",()=>{this.paintColor=d,this.hideColorButtons()}),this.paintColorButtons.push(a),i.parentElement.insertBefore(a,i.nextSibling),l.appendChild(a)}),this.paintSectionDiv.appendChild(l)}else this.hideColorButtons()}),o.addEventListener("click",()=>{if(this.hideSizeButtons(),this.hideColorButtons(),this.erasorButtons.length===0){const l=document.createElement("div");[2,4,6,8,10,12,16,20,32,64].forEach(d=>{const a=document.createElement("button");a.textContent=`${d}`,a.classList.add("singleErasorSizeConfigButton"),a.addEventListener("click",()=>{this.paintWidth=d,this.paintColor="white",this.hideErasorButtons()}),this.erasorButtons.push(a),o.parentElement.insertBefore(a,o.nextSibling),l.appendChild(a)}),this.paintSectionDiv.appendChild(l)}else this.hideErasorButtons()}),r.addEventListener("click",()=>{this.hideSizeButtons(),this.hideColorButtons(),this.hideErasorButtons(),this.context&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}),this.newItem.addEventListener("click",()=>{this.newItem.setAttribute("draggable","true"),this.putOnTop()}),this.newItem.addEventListener("drag",()=>{this.newItem.setAttribute("draggable","true"),this.putOnTop()}),window.addEventListener("mouseup",()=>{this.isPainting=!1,this.newItem.setAttribute("draggable","true")}),document.querySelector("main").appendChild(this.newItem),this.putOnTop(),this.paintSection(),f.paintInstances.push(this)}hideSizeButtons(){this.paintSizeButtons.forEach(t=>{t.remove()}),this.paintSizeButtons=[]}hideColorButtons(){this.paintColorButtons.forEach(t=>{t.remove()}),this.paintColorButtons=[]}hideErasorButtons(){this.erasorButtons.forEach(t=>{t.remove()}),this.erasorButtons=[]}paintSection(){this.paintSectionDiv=document.createElement("div"),this.paintSectionDiv.classList.add("paintSection"),this.newItem.appendChild(this.paintSectionDiv),this.paintSectionDiv.addEventListener("mousedown",t=>{t.stopPropagation(),this.newItem.setAttribute("draggable","false"),this.isPainting=!0,this.putOnTop(),this.context.beginPath(),this.context.moveTo(t.offsetX,t.offsetY),this.context.strokeStyle=this.paintColor,this.context.lineWidth=this.paintWidth}),this.canvas=document.createElement("canvas"),this.canvas.width=this.paintSectionDiv.clientWidth,this.canvas.height=this.paintSectionDiv.clientHeight,this.paintSectionDiv.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),this.canvas.addEventListener("mousemove",t=>{this.isPainting&&(this.context.lineTo(t.offsetX,t.offsetY),this.context.stroke())}),this.paintSectionDiv.addEventListener("mouseleave",()=>{this.isPainting&&(this.isPainting=!1,this.newItem.setAttribute("draggable","true"))})}putOnTop(){document.querySelectorAll(".chat, .memory, .paint").forEach(e=>{e.style.zIndex="1",e.classList.remove("focused")}),this.newItem.style.zIndex="2",this.newItem.classList.add("focused")}}const u=new C;u.move();let X=0,R=0,Y=0;const g=document.getElementById("memoryButton"),U=document.getElementById("chatButton"),$=document.getElementById("paintButton");let m=[];g.addEventListener("click",function(){m.length===0?[{x:4,y:4},{x:2,y:4},{x:2,y:2}].forEach(t=>{const e=document.createElement("button");e.textContent=`${t.x}x${t.y}`,e.classList.add("memoryConfigButton"),e.addEventListener("click",()=>{const n=new q(X++,t.x,t.y);u.addDraggableElement(n.newItem)}),m.push(e),g.parentElement.insertBefore(e,g.nextSibling)}):(m.forEach(c=>{c.remove()}),m=[])});U.addEventListener("click",()=>{const c=new h(R++);u.addDraggableElement(c.newItem)});$.addEventListener("click",()=>{const c=new f(Y++);u.addDraggableElement(c.newItem)});
